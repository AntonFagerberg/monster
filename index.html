<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>Phaser - Making your first game, part 1</title>
    <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }

        canvas {
          margin: 0 auto;
        }
    </style>
</head>
<body>


<script type="text/javascript">

var game = new Phaser.Game(1024, 768, Phaser.AUTO, '', { preload: preload, create: create, update: update }),
    tile_size = 64,
    world_state = [],
    quick_tick = 0,
    world_tick = 0,
    active = false;

var princess = (function () {
  var x = 5,
      y = 0,
      forward = true,
      sprite = null;

  return {
    update: function () {
      if ((forward && y < 7) || (!forward && y > 1)) {
        if (Math.random() >= 0.5) {
          if (forward) {
            y += 1;
          } else {
            y -= 1;
          }
        } else {
          if (x == 0 || (Math.random() >= 0.5 && x != 9)) {
            x += 1;
          } else {
            x -= 1;
          }
        }
      } else {
        forward = !forward;
        y -= 1;
      }

      console.log(x,y);

      sprite.x = (x + 1) * tile_size;
      sprite.y = (y + 1) * tile_size;
    },

    create: function () {
      sprite = game.add.sprite((x + 1) * tile_size, (y + 1) * tile_size, 'princess');
      sprite.scale.setTo(2, 2);
    }
  };
})();

function preload() {
  game.load.image('ground_1', 'assets/ground_tile_1.png');
  game.load.image('ground_2', 'assets/ground_tile_2.png');
  game.load.image('hole_monster', 'assets/h√•lmonster.png');
  game.load.image('princess', 'assets/princess.png');
  game.load.image('safe', 'assets/safe_tile.png');
  game.load.bitmapFont('font', 'assets/font/font.png', 'assets/font/font.fnt');
}

function create() {
    var x = 0,
      y = 0,
      click_x = -1,
      click_y = -1,
      ground = ['ground_1', 'ground_2'],
      sprite = null;

  for (x = 0; x < 10; x++) {
    for (y = 0; y < 8; y++) {
      if (y == 0) {
        world_state[x] = [];
      }

      world_state[x][y] = 0;
    }
  }

  for (x = 1; x < 11; x++) {
    sprite = game.add.sprite(x * tile_size, tile_size, 'safe');
    sprite.scale.setTo(2, 2)

    sprite = game.add.sprite(x * tile_size, 8 * tile_size, 'safe');
    sprite.scale.setTo(2, 2)
  }

  for (x = 1; x < 11; x++) {
    for (y = 2; y < 8; y++) {

      sprite = game.add.sprite(x * tile_size, y * tile_size, ground[(y + x) % 2]);
      sprite.scale.setTo(2, 2)
    }
  }

  var text = game.add.bitmapText(64, 32, 'font', 'You are the monster', 16);

  game.add.bitmapText(tile_size * 11 + (tile_size / 2), tile_size * 1 + (tile_size / 2) - 4, 'font', 'Start', 16);

  princess.create();
}

function update() {
  if (active) {
    quick_tick += 1;
    if (quick_tick >= 30) {
      world_tick += 1;
      quick_tick = 0;

      princess.update();
    }
  }

  if (game.input.activePointer.isDown) {
    click_x = parseInt(game.input.x / tile_size, 10);
    click_y = parseInt(game.input.y / tile_size, 10);

    if (click_x >= 11 && click_x <= 12 && click_y == 1 && !active) {
      active = true;
    }
  }
}

</script>

</body>
</html>
